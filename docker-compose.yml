version: '3.8'

services:
  xrootd-mcp-server:
    build: .
    image: ghcr.io/eic/xrootd-mcp-server:latest
    container_name: xrootd-mcp-server
    stdin_open: true
    tty: true
    environment:
      # Required: XRootD server URL
      XROOTD_SERVER: ${XROOTD_SERVER:-root://dtn-eic.jlab.org}
      
      # Optional: Base directory for access control
      XROOTD_BASE_DIR: ${XROOTD_BASE_DIR:-/volatile/eic/EPIC}
      
      # Optional: Caching configuration
      XROOTD_CACHE_ENABLED: ${XROOTD_CACHE_ENABLED:-true}
      XROOTD_CACHE_TTL: ${XROOTD_CACHE_TTL:-60}
      XROOTD_CACHE_MAX_SIZE: ${XROOTD_CACHE_MAX_SIZE:-1000}
      
      # Node.js environment
      NODE_ENV: production
    
    # Optional: Mount XRootD credentials if needed
    # volumes:
    #   - ~/.globus:/home/xrootd/.globus:ro
    #   - ~/.x509:/home/xrootd/.x509:ro
    
    # Resource limits (adjust as needed)
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
        reservations:
          cpus: '0.5'
          memory: 256M
    
    # Health check
    healthcheck:
      test: ["CMD", "node", "-e", "console.log('healthy')"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
    
    # Restart policy
    restart: unless-stopped
